(function(e,v){"function"===typeof define&&define.amd?define([],function(){return v(e.Countly)}):"object"===typeof module&&module.exports?module.exports=v(e.Countly):e.Countly=v(e.Countly)})("undefined"!==typeof window?window:this,function(e){var v,S,ea;function sa(b){var r=[];if("undefined"!==typeof b.options)for(var e=0;e<b.options.length;e++)b.options[e].selected&&r.push(b.options[e].value);return r.join(", ")}function ua(){var b=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(e){var d=(b+16*Math.random())%16|0;b=Math.floor(b/16);return("x"===e?d:d&3|8).toString(16)})}function n(){return Math.floor((new Date).getTime()/1E3)}function fa(){var b=(new Date).getTime();A>=b?A++:A=b;return A}function d(b,r,d){if(r&&Object.keys(r).length){if("undefined"!==typeof r[b])return r[b]}else if("undefined"!==typeof e[b])return e[b];return d}function ga(b,r,d){for(var k in e.i)e.i[k].tracking_crashes&&e.i[k].recordError(b,r,d)}function va(b){var e=[],d;for(d in b)e.push(d+"="+
encodeURIComponent(b[d]));return e.join("&")}function ha(b){return"/"===b.substr(b.length-1)?b.substr(0,b.length-1):b}function T(b,e){for(var d={},k,m=0;m<e.length;m++)k=e[m],"undefined"!==typeof b[k]&&(d[k]=b[k]);return d}function u(b,e,d,m,n,u){var v={};if(b){if(Object.keys(b).length>m){var G={},p=0,B;for(B in b)for(;p<m;)G[B]=b[B],p++;b=G}for(var M in b)m=k(M,e,n,u),G=k(b[M],d,n,u),v[m]=G}return v}function k(b,e,d,k){var m=b;"number"===typeof b&&(b=b.toString());"string"===typeof b&&b.length>e&&
(m=b.substring(0,e),k&&"undefined"!==typeof console&&console.log(d+", Key: ["+b+"] is longer than accepted length. It will be truncated."));return m}function ia(b){"undefined"===typeof b.pageY&&("number"===typeof b.clientX&&document.documentElement)&&(b.pageX=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,b.pageY=b.clientY+document.body.scrollTop+document.documentElement.scrollTop);return b}function X(){var b=document;return Math.max(Math.max(b.body.scrollHeight,b.documentElement.scrollHeight),
Math.max(b.body.offsetHeight,b.documentElement.offsetHeight),Math.max(b.body.clientHeight,b.documentElement.clientHeight))}function ja(){var b=document;return Math.max(Math.max(b.body.scrollWidth,b.documentElement.scrollWidth),Math.max(b.body.offsetWidth,b.documentElement.offsetWidth),Math.max(b.body.clientWidth,b.documentElement.clientWidth))}function wa(){var b=document;return Math.min(Math.min(b.body.clientHeight,b.documentElement.clientHeight),Math.min(b.body.offsetHeight,b.documentElement.offsetHeight),
window.innerHeight)}function xa(b){if(b)for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))return!0;return!1}function U(b,e,d,k,m,n){var b=document.createElement(b),u;b.setAttribute(e,d);b.setAttribute(k,m);n&&(b.onreadystatechange=b.onload=function(){u||n();u=!0});document.getElementsByTagName("head")[0].appendChild(b)}function ya(b,e){U("script","type","text/javascript","src",b,e)}function ka(b,e){U("link","rel","stylesheet","href",b,e)}function za(){var b=document.getElementById("cly-loader");
if(!b){var b=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css";e.styleSheet?e.styleSheet.cssText="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}":
e.appendChild(document.createTextNode("#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}"));
b.appendChild(e);b=document.createElement("div");b.setAttribute("id","cly-loader");document.body.appendChild(b)}b.style.display="block"}function Aa(){var b=document.getElementById("cly-loader");b&&(b.style.display="none")}if("undefined"!==typeof window){e=e||{};S="views";ea="location";e.features=["sessions","events",S,"scrolls","clicks","forms","crashes","attribution","users","star-rating",ea,"apm","feedback","remote-config"];e.utm={source:!0,medium:!0,campaign:!0,term:!0,content:!0};v="[CLY]_view";
e.q=e.q||[];e.onload=e.onload||[];var la="21.11.0",Ba="javascript_native_web",Ca=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,La=/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO|contxbot|PingdomBot|BingPreview|HeadlessChrome)/;
e.CountlyClass=function(b){function r(a){if(!c.ignore_visitor)if(a.key){a.count||(a.count=1);a.key=k(a.key,c.maxKeyLength,"add_cly_event",c.debug);a.segmentation=u(a.segmentation,c.maxKeyLength,c.maxValueSize,c.maxSegmentationValues,"add_cly_event",c.debug);var f=T(a,["key","count","sum","dur","segmentation"]);f.timestamp=fa();var b=new Date;f.hour=b.getHours();f.dow=b.getDay();t.push(f);h("cly_event",t);i("Adding event: ",a)}else i("Event must have key property")}function ta(){c.ignore_prefetch&&
("undefined"!==typeof document.visibilityState&&"prerender"===document.visibilityState)&&(c.ignore_visitor=!0);c.ignore_bots&&La.test(navigator.userAgent)&&(c.ignore_visitor=!0)}function A(a,f){if(!document.getElementById("countly-feedback-sticker-"+a._id))try{var b=document.createElement("div");b.className="countly-iframe-wrapper";b.id="countly-iframe-wrapper-"+a._id;var j=document.createElement("span");j.className="countly-feedback-close-icon";j.id="countly-feedback-close-icon-"+a._id;j.innerText=
"x";var l=document.createElement("iframe");l.name="countly-feedback-iframe";l.id="countly-feedback-iframe";l.src=c.url+"/feedback?widget_id="+a._id+"&app_key="+c.app_key+"&device_id="+c.device_id+"&sdk_version="+la;document.body.appendChild(b);b.appendChild(j);b.appendChild(l);m(document.getElementById("countly-feedback-close-icon-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="none";document.getElementById("cfbg").style.display="none"});if(f){var g=
document.createElementNS("http://www.w3.org/2000/svg","svg");g.id="feedback-sticker-svg";g.setAttribute("aria-hidden","true");g.setAttribute("data-prefix","far");g.setAttribute("data-icon","grin");g.setAttribute("class","svg-inline--fa fa-grin fa-w-16");g.setAttribute("role","img");g.setAttribute("xmlns","http://www.w3.org/2000/svg");g.setAttribute("viewBox","0 0 496 512");var e=document.createElementNS("http://www.w3.org/2000/svg","path");e.id="smileyPathInStickerSvg";e.setAttribute("fill","white");
e.setAttribute("d","M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z");var h=document.createElement("span");
h.innerText=a.trigger_button_text;var d=document.createElement("div");d.style.color=7>a.trigger_font_color?"#"+a.trigger_font_color:a.trigger_font_color;d.style.backgroundColor=7>a.trigger_bg_color.length?"#"+a.trigger_bg_color:a.trigger_bg_color;d.className="countly-feedback-sticker  "+a.trigger_position+"-"+a.trigger_size;d.id="countly-feedback-sticker-"+a._id;g.appendChild(e);d.appendChild(g);d.appendChild(h);document.body.appendChild(d);var k=document.getElementById("smileyPathInStickerSvg");
k&&(k.style.fill=7>a.trigger_font_color?"#"+a.trigger_font_color:a.trigger_font_color);m(document.getElementById("countly-feedback-sticker-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block";document.getElementById("cfbg").style.display="block"})}else document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block",document.getElementById("cfbg").style.display="block"}catch(r){i("Somethings went wrong while element injecting process: "+
r)}}function K(){var a;if("undefined"!==typeof c.onload&&0<c.onload.length){for(a=0;a<c.onload.length;a++)if("function"===typeof c.onload[a])c.onload[a](c);c.onload=[]}}function L(){if(N){var a={name:N};c.check_consent(S)&&r({key:v,dur:O?n()-Y:Z,segmentation:a});N=null}}function U(){if($){var a=h("cly_session");if(!a||parseInt(a)<=n())C=!1,c.begin_session(!aa);h("cly_session",n()+60*Da)}}function G(a){a.app_key=c.app_key;a.device_id=c.device_id;a.sdk_name=Ba;a.sdk_version=la;c.check_consent(ea)?(c.country_code&&
(a.country_code=c.country_code),c.city&&(a.city=c.city),null!==c.ip_address&&(a.ip_address=c.ip_address)):a.location="";a.timestamp=fa();var f=new Date;a.hour=f.getHours();a.dow=f.getDay()}function p(a){c.ignore_visitor||(!c.app_key||!c.device_id?i("app_key or device_id is missing"):(G(a),s.length>Ma&&s.shift(),s.push(a),h("cly_queue",s,!0)))}function B(){K();if(c.test_mode||c.ignore_visitor)ma=!1;else{ma=!0;var a=0;if(na&&"undefined"!==typeof e.q&&0<e.q.length){var f,b=e.q;e.q=[];for(a=0;a<b.length;a++)if(f=
b[a],i("Processing queued call",f),"function"===typeof f)f();else if(Array.isArray(f)&&0<f.length){var j=c,l=0;e.i[f[l]]&&(j=e.i[f[l]],l++);if("function"===typeof j[f[l]])j[f[l]].apply(j,f.slice(l+1));else if(0===f[l].indexOf("userData.")){var g=f[l].replace("userData.","");"function"===typeof j.userData[g]&&j.userData[g].apply(j,f.slice(l+1))}else"function"===typeof e[f[l]]&&e[f[l]].apply(e,f.slice(l+1))}}C&&(aa&&O)&&(a=n(),a-H>Na&&(c.session_duration(a-H),H=a));0<t.length&&(t.length<=Ea?(p({events:JSON.stringify(t)}),
t=[]):(a=t.splice(0,Ea),p({events:JSON.stringify(a)})),h("cly_event",t));!D&&(0<s.length&&oa&&n()>Fa)&&(oa=!1,a=s[0],xa(E)&&(I&&(clearTimeout(I),I=null),a.consent=JSON.stringify(E),E={}),i("Processing request",a),h("cly_queue",s,!0),P(c.url+Oa,a,function(a,f){i("Request Finished",f,a);a?Fa=n()+Pa:s.shift();h("cly_queue",s,!0);oa=!0}));setTimeout(B,Qa)}}function M(){return h("cly_id")||ua()}function ba(){var a=JSON.parse(JSON.stringify(c.metrics||{}));a._app_version=a._app_version||c.app_version;a._ua=
a._ua||navigator.userAgent;if(screen.width){var f=screen.width?parseInt(screen.width):0,b=screen.height?parseInt(screen.height):0;if(0!==f&&0!==b){if(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&window.devicePixelRatio)f=Math.round(f*window.devicePixelRatio),b=Math.round(b*window.devicePixelRatio);else if(90===Math.abs(window.orientation))var j=f,f=b,b=j;a._resolution=a._resolution||""+f+"x"+b}}window.devicePixelRatio&&(a._density=a._density||window.devicePixelRatio);f=navigator.language||
navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;"undefined"!==typeof f&&(a._locale=a._locale||f);if("undefined"!==typeof document.referrer&&document.referrer.length&&(f=Ca.exec(document.referrer))&&f[11]&&f[11]!==window.location.hostname){f=!1;if(J&&J.length)for(b=0;b<J.length;b++)try{if(RegExp(J[b]).test(document.referrer)){i("Ignored:",document.referrer);f=!0;break}}catch(l){i("Problem with regex",J[b])}f||(a._store=a._store||document.referrer)}i("Got metrics",a);return a}
function i(){c.debug&&"undefined"!==typeof console&&(arguments[1]&&"object"===typeof arguments[1]&&(arguments[1]=JSON.stringify(arguments[1])),na||(arguments[0]="["+c.app_key+"] "+arguments[0]),console.log(Array.prototype.slice.call(arguments).join("\n")))}function P(a,f,b){try{i("Sending XML HTTP request");var j=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLHTTP"):null,f=f||{},l=va(f),g="GET";if(c.force_post||2E3<=l.length)g="POST";"GET"===
g?j.open("GET",a+"?"+l,!0):(j.open("POST",a,!0),j.setRequestHeader("Content-type","application/x-www-form-urlencoded"));for(var e in c.headers)j.setRequestHeader(e,c.headers[e]);j.onreadystatechange=function(){4===this.readyState&&200<=this.status&&300>this.status?"function"===typeof b&&b(!1,f,this.responseText):4===this.readyState&&(i("Failed Server XML HTTP request",this.status),"function"===typeof b&&b(!0,f))};"GET"===g?j.send():j.send(l)}catch(d){i("Failed XML HTTP request",d),"function"===typeof b&&
b(!0,f)}}function Ga(a){h("cly_token",a)}function h(a,f,b,j){function l(a,f,b){var c=new Date;c.setTime(c.getTime()+864E5*b);b="; expires="+c.toGMTString();document.cookie=a+"="+f+b+"; path=/"}if("none"!==c.storage){j||(a=c.app_key+"/"+a,c.namespace&&(a=ha(c.namespace)+"/"+a));var b=b||"localstorage"===c.storage,g;"undefined"!==typeof f&&null!==f&&(f=c.serialize(f),V?localStorage.setItem(a,f):b||l(a,f,30));if("undefined"===typeof f){if(V)g=localStorage.getItem(a);else if(!b)a:{a+="=";f=document.cookie.split(";");
b=0;for(j=f.length;b<j;b++){for(g=f[b];" "===g.charAt(0);)g=g.substring(1,g.length);if(0===g.indexOf(a)){g=g.substring(a.length,g.length);break a}}g=null}return c.deserialize(g)}null===f&&(V?localStorage.removeItem(a):b||l(a,"",-1))}}var c=this,na=!e.i,C=!1,Oa="/i",Qa=d("interval",b,500),Ma=d("queue_size",b,1E3),s=[],t=[],w={},Q=[],R={},J=d("ignore_referrers",b,[]),Ha=null,aa=!0,H,Ia=0,N=null,Y=0,Z=0,Fa=0,Pa=d("fail_timeout",b,60),Ja=d("inactivity_time",b,20),ca=0,Na=d("session_update",b,60),Ea=d("max_events",
b,100),pa=d("max_logs",b,null),$=d("use_session_cookie",b,!0),Da=d("session_cookie_timeout",b,30),oa=!0,ma=!1,D=d("offline_mode",b,!1),E={},F={},O=!0,Ra=n(),V=!0,W=null;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch(Ta){V=!1}for(var q={},qa=0;qa<e.features.length;qa++)q[e.features[qa]]={};this.initialize=function(){this.serialize=b.serialize||e.serialize;this.deserialize=b.deserialize||e.deserialize;this.getViewName=b.getViewName||e.getViewName;this.getViewUrl=
b.getViewUrl||e.getViewUrl;this.namespace=d("namespace",b,"");this.app_key=d("app_key",b,null);this.onload=d("onload",b,[]);this.utm=d("utm",b,{source:!0,medium:!0,campaign:!0,term:!0,content:!0});this.ignore_prefetch=d("ignore_prefetch",b,!0);this.debug=d("debug",b,!1);this.test_mode=d("test_mode",b,!1);this.metrics=d("metrics",b,{});this.headers=d("headers",b,{});this.url=ha(d("url",b,""));this.app_version=d("app_version",b,"0.0");this.country_code=d("country_code",b,null);this.city=d("city",b,
null);this.ip_address=d("ip_address",b,null);this.ignore_bots=d("ignore_bots",b,!0);this.force_post=d("force_post",b,!1);this.remote_config=d("remote_config",b,!1);this.ignore_visitor=d("ignore_visitor",b,!1);this.require_consent=d("require_consent",b,!1);this.track_domains=d("track_domains",b,!0);this.storage=d("storage",b,"default");this.enableOrientationTracking=d("enable_orientation_tracking",b,!0);this.maxKeyLength=d("max_key_length",b,128);this.maxValueSize=d("max_value_size",b,256);this.maxSegmentationValues=
d("max_segmentation_values",b,30);this.maxBreadcrumbCount=d("max_breadcrumb_count",b,null);this.maxStackTraceLinesPerThread=d("max_stack_trace_lines_per_thread",b,30);this.maxStackTraceLineLength=d("max_stack_trace_line_length",b,200);pa&&!this.maxBreadcrumbCount?(this.maxBreadcrumbCount=pa,i("'maxCrashLogs' is deprecated. Use 'maxBreadcrumbCount' instead!")):!pa&&!this.maxBreadcrumbCount&&(this.maxBreadcrumbCount=100);"cookie"===this.storage&&(V=!1);Array.isArray(J)||(J=[]);""===this.url&&(i("Please provide server URL"),
this.ignore_visitor=!0);h("cly_ignore")&&(this.ignore_visitor=!0);if(h(c.namespace+"cly_id",void 0,!1,!0)){h("cly_id",h(c.namespace+"cly_id",void 0,!1,!0));h("cly_event",h(c.namespace+"cly_event",void 0,!1,!0));h("cly_session",h(c.namespace+"cly_session",void 0,!1,!0));var a=h(c.namespace+"cly_queue",void 0,!1,!0);Array.isArray(a)&&(a=a.filter(function(a){return a.app_key===c.app_key}),h("cly_queue",a));h(c.namespace+"cly_cmp_id",void 0,!1,!0)&&(h("cly_cmp_id",h(c.namespace+"cly_cmp_id",void 0,!1,
!0)),h("cly_cmp_uid",h(c.namespace+"cly_cmp_uid",void 0,!1,!0)));h(c.namespace+"cly_ignore",void 0,!1,!0)&&h("cly_ignore",h(c.namespace+"cly_ignore",void 0,!1,!0));h("cly_id",null,!1,!0);h("cly_event",null,!1,!0);h("cly_session",null,!1,!0);h("cly_queue",null,!1,!0);h("cly_cmp_id",null,!1,!0);h("cly_cmp_uid",null,!1,!0);h("cly_ignore",null,!1,!0)}D?this.device_id||(this.device_id="[CLY]_temp_id"):this.device_id=d("device_id",b,M());s=h("cly_queue")||[];t=h("cly_event")||[];w=h("cly_remote_configs")||
{};ta();if(window.name&&0===window.name.indexOf("cly:"))try{this.passed_data=JSON.parse(window.name.replace("cly:",""))}catch(f){i("Could not parse name",window.name)}else if(location.hash&&0===location.hash.indexOf("#cly:"))try{this.passed_data=JSON.parse(location.hash.replace("#cly:",""))}catch(Sa){i("Could not parse hash",location.hash)}if((this.passed_data&&this.passed_data.app_key&&this.passed_data.app_key===this.app_key||this.passed_data&&!this.passed_data.app_key&&na)&&this.passed_data.token&&
this.passed_data.purpose)this.passed_data.token!==h("cly_old_token")&&(Ga(this.passed_data.token),h("cly_old_token",this.passed_data.token)),this.passed_data.url=this.passed_data.url||this.url,"heatmap"===this.passed_data.purpose&&(this.ignore_visitor=!0,za(),ya(this.passed_data.url+"/views/heatmap.js",Aa));if(!this.ignore_visitor){i("Countly initialized");if(location.search){for(var a=location.search.substring(1).split("&"),j={},l=!1,g=0;g<a.length;g++){var x=a[g].split("=");"cly_id"===x[0]?h("cly_cmp_id",
x[1]):"cly_uid"===x[0]?h("cly_cmp_uid",x[1]):"cly_device_id"===x[0]?this.device_id=x[1]:0===(x[0]+"").indexOf("utm_")&&this.utm[x[0].replace("utm_","")]&&(j[x[0].replace("utm_","")]=x[1],l=!0)}if(l){for(var k in this.utm)j[k]?this.userData.set("utm_"+k,j[k]):this.userData.unset("utm_"+k);this.userData.save()}}D||this.device_id!==h("cly_id")&&h("cly_id",this.device_id);K();setTimeout(function(){B();c.remote_config&&c.fetch_remote_config(c.remote_config)},1)}document.documentElement.setAttribute("data-countly-useragent",
navigator.userAgent)};this.group_features=function(a){if(a)for(var f in a)q[f]?i("Feature name "+f+" is already reserved"):"string"===typeof a[f]?q[f]={features:[a[f]]}:a[f]&&Array.isArray(a[f])&&a[f].length?q[f]={features:a[f]}:i("Incorrect feature list for "+f+" value: "+a[f]);else i("Incorrect features: "+a)};this.check_consent=function(a){if(!this.require_consent)return!0;if(q[a])return q[a]&&q[a].optin?!0:!1;i("No feature available for "+a);return!1};this.check_any_consent=function(){if(!this.require_consent)return!0;
for(var a in q)if(q[a]&&q[a].optin)return!0;return!1};this.add_consent=function(a){i("Adding consent for "+a);if(Array.isArray(a))for(var f=0;f<a.length;f++)this.add_consent(a[f]);else q[a]?q[a].features?(q[a].optin=!0,this.add_consent(q[a].features)):!0!==q[a].optin&&(E[a]=!0,q[a].optin=!0,Ka(),setTimeout(function(){"sessions"===a&&F.begin_session?(c.begin_session.apply(c,F.begin_session),F.begin_session=null):a===S&&F.track_pageview&&(N=null,c.track_pageview.apply(c,F.track_pageview),F.track_pageview=
null)},1)):i("No feature available for "+a)};this.remove_consent=function(a){i("Removing consent for "+a);this.remove_consent_internal(a,!0)};this.remove_consent_internal=function(a,f){f=f||!1;if(Array.isArray(a))for(var b=0;b<a.length;b++)this.remove_consent_internal(a[b],f);else q[a]?(q[a].features?this.remove_consent_internal(q[a].features,f):f&&!1!==q[a].optin&&(E[a]=!1,Ka()),q[a].optin=!1):i("No feature available for "+a)};var I,Ka=function(){I&&(clearTimeout(I),I=null);I=setTimeout(function(){xa(E)&&
(p({consent:JSON.stringify(E)}),E={})},1E3)};this.enable_offline_mode=function(){this.remove_consent_internal(e.features,!1);D=!0;this.device_id="[CLY]_temp_id"};this.disable_offline_mode=function(a){D=!1;a&&this.device_id!==a?(this.device_id=a,h("cly_id",this.device_id),i("Changing id")):(this.device_id=M(),this.device_id!==h("cly_id")&&h("cly_id",this.device_id));a=!1;if(0<s.length)for(var f=0;f<s.length;f++)"[CLY]_temp_id"===s[f].device_id&&(s[f].device_id=this.device_id,a=!0);a&&h("cly_queue",
s,!0)};this.begin_session=function(a,f){if(this.check_consent("sessions")){if(!C){this.enableOrientationTracking&&(this.report_orientation(),m(window,"resize",function(){c.report_orientation()}));H=n();C=!0;aa=a?!1:!0;var b=h("cly_session");if(f||!$||!b||parseInt(b)<=n())i("Session started"),null===W&&(W=!0),b={begin_session:1},b.metrics=JSON.stringify(ba()),p(b);h("cly_session",n()+60*Da)}}else F.begin_session=arguments};this.session_duration=function(a){this.check_consent("sessions")&&C&&(i("Session extended",
a),p({session_duration:a}),U())};this.end_session=function(a,f){this.check_consent("sessions")&&C&&(a=a||n()-H,L(),!$||f?(i("Ending session"),p({end_session:1,session_duration:a})):this.session_duration(a),C=!1)};this.change_id=function(a,f){if(!a||"string"!==typeof a||0===a.length)i("change_id: The provided ID: "+a+" is not a valid ID");else if(this.device_id!==a){f||(0<t.length&&(p({events:JSON.stringify(t)}),t=[],h("cly_event",t)),this.end_session(null,!0),R={},this.remove_consent_internal(e.features,
!1));var b=this.device_id;this.device_id=a;h("cly_id",this.device_id);i("Changing id");f?p({old_device_id:b}):this.begin_session(!aa,!0);this.remote_config&&(w={},h("cly_remote_configs",w),this.fetch_remote_config(this.remote_config))}};this.add_event=function(a){var f=!1;switch(a.key){case "[CLY]_nps":f=this.check_consent("feedback");break;case "[CLY]_survey":f=this.check_consent("feedback");break;case "[CLY]_star_rating":f=this.check_consent("star-rating");break;case v:f=this.check_consent("view");
break;case "[CLY]_orientation":f=this.check_consent("users");break;case "[CLY]_push_action":f=this.check_consent("push");break;case "[CLY]_action":f=this.check_consent("clicks")||this.check_consent("scroll");break;default:f=this.check_consent("events")}f&&r(a)};this.start_event=function(a){a=k(a,c.maxKeyLength,"start_event",c.debug);R[a]?i("Timed event with key ["+a+"] already started"):R[a]=n()};this.end_event=function(a){"string"===typeof a&&(a={key:a});a.key?R[a.key]?(a.dur=n()-R[a.key],this.add_event(a),
delete R[a.key]):i("Timed event with key "+a.key+" was not started"):i("Event must have key property")};this.report_orientation=function(a){this.check_consent("users")&&r({key:"[CLY]_orientation",segmentation:{mode:a||(window.innerWidth>window.innerHeight?"landscape":"portrait")}})};this.report_conversion=function(a,f){i("report_conversion, Deprecated function call! Use 'recordDirectAttribution' in place of this call. Call will be redirected now!");this.recordDirectAttribution(a,f)};this.recordDirectAttribution=
function(a,f){this.check_consent("attribution")&&(a=a||h("cly_cmp_id")||"cly_organic",f=f||h("cly_cmp_uid"),a&&f?p({campaign_id:a,campaign_user:f}):a&&p({campaign_id:a}))};this.user_details=function(a){i("Trying to add user details: ",a);this.check_consent("users")&&(a.name=k(a.name,c.maxValueSize,"user_details",c.debug),a.username=k(a.username,c.maxValueSize,"user_details",c.debug),a.email=k(a.email,c.maxValueSize,"user_details",c.debug),a.organization=k(a.organization,c.maxValueSize,"user_details",
c.debug),a.phone=k(a.phone,c.maxValueSize,"user_details",c.debug),a.picture=k(a.picture,4096,"user_details",c.debug),a.gender=k(a.gender,c.maxValueSize,"user_details",c.debug),a.byear=k(a.byear,c.maxValueSize,"user_details",c.debug),a.custom=u(a.custom,c.maxKeyLength,c.maxValueSize,c.maxSegmentationValues,"user_details",c.debug),p({user_details:JSON.stringify(T(a,"name username email organization phone picture gender byear custom".split(" ")))}))};var y={},z=function(a,f,b){c.check_consent("users")&&
(y[a]||(y[a]={}),"$push"===b||"$pull"===b||"$addToSet"===b?(y[a][b]||(y[a][b]=[]),y[a][b].push(f)):y[a][b]=f)};this.userData={set:function(a,f){a=k(a,c.maxKeyLength,"userData set",c.debug);f=k(f,c.maxValueSize,"userData set",c.debug);y[a]=f},unset:function(a){y[a]=""},set_once:function(a,f){a=k(a,c.maxKeyLength,"userData set_once",c.debug);f=k(f,c.maxValueSize,"userData set_once",c.debug);z(a,f,"$setOnce")},increment:function(a){a=k(a,c.maxKeyLength,"userData increment",c.debug);z(a,1,"$inc")},increment_by:function(a,
f){a=k(a,c.maxKeyLength,"userData increment_by",c.debug);f=k(f,c.maxValueSize,"userData increment_by",c.debug);z(a,f,"$inc")},multiply:function(a,f){a=k(a,c.maxKeyLength,"userData multiply",c.debug);f=k(f,c.maxValueSize,"userData multiply",c.debug);z(a,f,"$mul")},max:function(a,f){a=k(a,c.maxKeyLength,"userData max",c.debug);f=k(f,c.maxValueSize,"userData max",c.debug);z(a,f,"$max")},min:function(a,f){a=k(a,c.maxKeyLength,"userData min",c.debug);f=k(f,c.maxValueSize,"userData min",c.debug);z(a,f,
"$min")},push:function(a,f){a=k(a,c.maxKeyLength,"userData push",c.debug);f=k(f,c.maxValueSize,"userData push",c.debug);z(a,f,"$push")},push_unique:function(a,f){a=k(a,c.maxKeyLength,"userData push_unique",c.debug);f=k(f,c.maxValueSize,"userData push_unique",c.debug);z(a,f,"$addToSet")},pull:function(a,f){z(a,f,"$pull")},save:function(){c.check_consent("users")&&p({user_details:JSON.stringify({custom:y})});y={}}};this.report_trace=function(a){if(this.check_consent("apm")){for(var f="type name stz etz apm_metrics apm_attr".split(" "),
b=0;b<f.length;b++)if("apm_attr"!==f[b]&&"undefined"===typeof a[f[b]]){i("APM trace must have a",f[b]);return}a.name=k(a.name,c.maxKeyLength,"report_trace",c.debug);a.app_metrics=u(a.app_metrics,c.maxKeyLength,c.maxValueSize,c.maxSegmentationValues,"report_trace",c.debug);f=T(a,f);f.timestamp=a.stz;a=new Date;f.hour=a.getHours();f.dow=a.getDay();p({apm:JSON.stringify(f)});i("Adding APM trace: ",f)}};this.track_errors=function(a){e.i[this.app_key].tracking_crashes=!0;window.cly_crashes||(window.cly_crashes=
!0,Ha=a,window.onerror=function(a,b,c,l,g){if("undefined"!==typeof g)ga(g,!1);else{var l=l||window.event&&window.event.errorCharacter,e="";"undefined"!==typeof a&&(e+=a+"\n");"undefined"!==typeof b&&(e+="at "+b);"undefined"!==typeof c&&(e+=":"+c);"undefined"!==typeof l&&(e+=":"+l);e+="\n";try{for(var i=[],d=arguments.callee.caller;d;)i.push(d.name),d=d.caller;e+=i.join("\n")}catch(h){}ga(e,!1)}},window.addEventListener("unhandledrejection",function(a){ga(Error("Unhandled rejection (reason: "+(a.reason&&
a.reason.stack?a.reason.stack:a.reason)+")."),!0)}))};this.log_error=function(a,b){this.recordError(a,!0,b)};this.add_log=function(a){if(this.check_consent("crashes")){for(a=k(a,c.maxValueSize,"add_log",c.debug);Q.length>=c.maxBreadcrumbCount;)Q.shift(),i("Reached maximum crashLogs size. Will erase the oldest one.");Q.push(a)}};this.fetch_remote_config=function(a,b,c){if(this.check_consent("remote-config")){var j={method:"fetch_remote_config"};this.check_consent("sessions")&&(j.metrics=JSON.stringify(ba()));
a&&(!c&&"function"===typeof a?(c=a,a=null):Array.isArray(a)&&a.length&&(j.keys=JSON.stringify(a)));b&&(!c&&"function"===typeof b?(c=b,b=null):Array.isArray(b)&&b.length&&(j.omit_keys=JSON.stringify(b)));G(j);P(this.url+"/o/sdk",j,function(a,b,f){try{var e=JSON.parse(f);if(j.keys||j.omit_keys)for(var i in e)w[i]=e[i];else w=e;h("cly_remote_configs",w)}catch(d){}"function"===typeof c&&c(a,w)})}else i("Remote config requires explicit consent"),"function"===typeof c&&c(Error("Remote config requires explicit consent"),
w)};this.get_remote_config=function(a){return"undefined"!==typeof a?w[a]:w};this.stop_time=function(){O&&(O=!1,Ia=n()-H,Z=n()-Y)};this.start_time=function(){O||(O=!0,H=n()-Ia,Y=n()-Z,Z=0,U())};this.track_sessions=function(){function a(){document[e]||!document.hasFocus()?(c.stop_time(),i("onchange, stopped time")):(c.start_time(),i("onchange, started time"))}function b(){ca>=Ja&&c.start_time();ca=0}this.begin_session();i("begin session");this.start_time();i("started time");m(window,"beforeunload",
function(){c.end_session()});var e="hidden";m(window,"focus",a);m(window,"blur",a);m(window,"pageshow",a);m(window,"pagehide",a);"onfocusin"in document&&(m(window,"focusin",a),m(window,"focusout",a));if(e in document)document.addEventListener("visibilitychange",a),i("added visibilitychange");else if((e="mozHidden")in document)document.addEventListener("mozvisibilitychange",a),i("added mozvisibilitychange");else if((e="webkitHidden")in document)document.addEventListener("webkitvisibilitychange",a),
i("added webkitvisibilitychange");else if((e="msHidden")in document)document.addEventListener("msvisibilitychange",a),i("added msvisibilitychange");m(window,"mousemove",b);m(window,"click",b);m(window,"keydown",b);m(window,"scroll",b);setInterval(function(){ca++;ca>=Ja&&c.stop_time()},6E4)};this.track_pageview=function(a,b,e){L();a=k(a,c.maxKeyLength,"track_pageview",c.debug);e=u(e,c.maxKeyLength,c.maxValueSize,c.maxSegmentationValues,"track_pageview",c.debug);a&&Array.isArray(a)&&(b=a,a=null);a||
(a=this.getViewName());if(b&&b.length)for(var j=0;j<b.length;j++)try{if(RegExp(b[j]).test(a)){i("Ignored:",a);return}}catch(l){i("Problem with regex",b[j])}N=a;Y=n();j={name:a,visit:1,view:this.getViewUrl()};j=u(j,c.maxKeyLength,c.maxValueSize,c.maxSegmentationValues,"track_pageview",c.debug);this.track_domains&&(j.domain=window.location.hostname);if($)if(C)W&&(W=!1,j.start=1);else{var g=h("cly_session");if(!g||parseInt(g)<=n())W=!1,j.start=1}else if("undefined"!==typeof document.referrer&&document.referrer.length&&
(g=Ca.exec(document.referrer))&&g[11]&&g[11]!==window.location.hostname)j.start=1;if(e)for(var d in e)"undefined"===typeof j[d]&&(j[d]=e[d]);this.check_consent(S)?r({key:v,segmentation:j}):F.track_pageview=arguments};this.track_view=function(a,b,c){this.track_pageview(a,b,c)};this.track_clicks=function(a){var a=a||document,b=!0;m(a,"click",function(a){if(b){b=!1;ia(a);if("undefined"!==typeof a.pageX&&"undefined"!==typeof a.pageY){var j=X(),e=ja();c.check_consent("clicks")&&(a={type:"click",x:a.pageX,
y:a.pageY,width:e,height:j,view:c.getViewUrl()},a=u(a,c.maxKeyLength,c.maxValueSize,c.maxSegmentationValues,"processClick",c.debug),c.track_domains&&(a.domain=window.location.hostname),r({key:"[CLY]_action",segmentation:a}))}setTimeout(function(){b=!0},1E3)}})};this.track_scrolls=function(a){var a=a||window,b=!0,e=0;m(a,"scroll",function(){e=Math.max(e,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)});m(a,"beforeunload",function(){if(b){b=!1;var a=X(),l=ja(),g=wa();c.check_consent("scrolls")&&
(a={type:"scroll",y:e+g,width:l,height:a,view:c.getViewUrl()},a=u(a,c.maxKeyLength,c.maxValueSize,c.maxSegmentationValues,"processScrollView",c.debug),c.track_domains&&(a.domain=window.location.hostname),r({key:"[CLY]_action",segmentation:a}))}})};this.track_links=function(a){a=a||document;m(a,"click",function(a){var b;a:{b=da(a);var j;for(j="A";b;){if(b.nodeName.toUpperCase()===j)break a;b=b.parentElement}b=void 0}b&&(ia(a),c.check_consent("clicks")&&r({key:"linkClick",segmentation:{href:b.href,
text:b.innerText,id:b.id,view:c.getViewUrl()}}))})};this.track_forms=function(a,b){function e(a){return a.name||a.id||a.type||a.nodeName}a=a||document;m(a,"submit",function(a){var a=da(a),l={id:a.attributes.id&&a.attributes.id.nodeValue,name:a.attributes.name&&a.attributes.name.nodeValue,action:a.attributes.action&&a.attributes.action.nodeValue,method:a.attributes.method&&a.attributes.method.nodeValue,view:c.getViewUrl()},g;if("undefined"!==typeof a.elements){for(var i=0;i<a.elements.length;i++)if((g=
a.elements[i])&&"password"!==g.type&&-1===g.className.indexOf("cly_user_ignore"))"undefined"===typeof l["input:"+e(g)]&&(l["input:"+e(g)]=[]),"select"===g.nodeName.toLowerCase()?"undefined"!==typeof g.multiple?l["input:"+e(g)].push(sa(g)):l["input:"+e(g)].push(g.options[g.selectedIndex].value):"input"===g.nodeName.toLowerCase()?"undefined"!==typeof g.type?"checkbox"===g.type.toLowerCase()||"radio"===g.type.toLowerCase()?g.checked&&l["input:"+e(g)].push(g.value):("hidden"!==g.type.toLowerCase()||b)&&
l["input:"+e(g)].push(g.value):l["input:"+e(g)].push(g.value):"textarea"===g.nodeName.toLowerCase()?l["input:"+e(g)].push(g.value):"undefined"!==typeof g.value&&l["input:"+e(g)].push(g.value);for(var d in l)l[d]&&"function"===typeof l[d].join&&(l[d]=l[d].join(", "))}c.check_consent("forms")&&r({key:"formSubmit",segmentation:l})})};this.collect_from_forms=function(a,b){a=a||document;m(a,"submit",function(e){var e=da(e),j={},l=!1,g;if("undefined"!==typeof e.elements){var d={},h=a.getElementsByTagName("LABEL"),
k;for(k=0;k<h.length;k++)h[k].htmlFor&&""!==h[k].htmlFor&&(d[h[k].htmlFor]=h[k].innerText||h[k].textContent||h[k].innerHTML);for(k=0;k<e.elements.length;k++)if((g=e.elements[k])&&"password"!==g.type&&-1===g.className.indexOf("cly_user_ignore"))if(h="","select"===g.nodeName.toLowerCase()?h="undefined"!==typeof g.multiple?sa(g):g.options[g.selectedIndex].value:"input"===g.nodeName.toLowerCase()?"undefined"!==typeof g.type?"checkbox"===g.type.toLowerCase()||"radio"===g.type.toLowerCase()?g.checked&&
(h=g.value):h=g.value:h=g.value:"textarea"===g.nodeName.toLowerCase()?h=g.value:"undefined"!==typeof g.value&&(h=g.value),g.className&&-1!==g.className.indexOf("cly_user_")){var m=g.className.split(" ");for(g=0;g<m.length;g++)if(0===m[g].indexOf("cly_user_")){j[m[g].replace("cly_user_","")]=h;l=!0;break}}else if(g.type&&"email"===g.type.toLowerCase()||g.name&&-1!==g.name.toLowerCase().indexOf("email")||g.id&&-1!==g.id.toLowerCase().indexOf("email")||g.id&&d[g.id]&&-1!==d[g.id].toLowerCase().indexOf("email")||
/[^@\s]+@[^@\s]+\.[^@\s]+/.test(h))j.email||(j.email=h),l=!0;else if(g.name&&-1!==g.name.toLowerCase().indexOf("username")||g.id&&-1!==g.id.toLowerCase().indexOf("username")||g.id&&d[g.id]&&-1!==d[g.id].toLowerCase().indexOf("username"))j.username||(j.username=h),l=!0;else if(g.name&&(-1!==g.name.toLowerCase().indexOf("tel")||-1!==g.name.toLowerCase().indexOf("phone")||-1!==g.name.toLowerCase().indexOf("number"))||g.id&&(-1!==g.id.toLowerCase().indexOf("tel")||-1!==g.id.toLowerCase().indexOf("phone")||
-1!==g.id.toLowerCase().indexOf("number"))||g.id&&d[g.id]&&(-1!==d[g.id].toLowerCase().indexOf("tel")||-1!==d[g.id].toLowerCase().indexOf("phone")||-1!==d[g.id].toLowerCase().indexOf("number")))j.phone||(j.phone=h),l=!0;else if(g.name&&(-1!==g.name.toLowerCase().indexOf("org")||-1!==g.name.toLowerCase().indexOf("company"))||g.id&&(-1!==g.id.toLowerCase().indexOf("org")||-1!==g.id.toLowerCase().indexOf("company"))||g.id&&d[g.id]&&(-1!==d[g.id].toLowerCase().indexOf("org")||-1!==d[g.id].toLowerCase().indexOf("company")))j.organization||
(j.organization=h),l=!0;else if(g.name&&-1!==g.name.toLowerCase().indexOf("name")||g.id&&-1!==g.id.toLowerCase().indexOf("name")||g.id&&d[g.id]&&-1!==d[g.id].toLowerCase().indexOf("name"))j.name||(j.name=""),j.name+=h+" ",l=!0}l&&(i("Gathered user data",j),b?c.user_details({custom:j}):c.user_details(j))})};this.collect_from_facebook=function(a){FB&&FB.api&&FB.api("/me",function(b){var e={};b.name&&(e.name=b.name);b.email&&(e.email=b.email);"male"===b.gender?e.gender="M":"female"===b.gender&&(e.gender=
"F");if(b.birthday){var j=b.birthday.split("/").pop();j&&4===j.length&&(e.byear=j)}b.work&&(b.work[0]&&b.work[0].employer&&b.work[0].employer.name)&&(e.organization=b.work[0].employer.name);if(a){e.custom={};for(var l in a){for(var j=a[l].split("."),g=b,d=0;d<j.length&&!(g=g[j[d]],"undefined"===typeof g);d++);"undefined"!==typeof g&&(e.custom[l]=g)}}c.user_details(e)})};this.opt_out=function(){this.ignore_visitor=!0;h("cly_ignore",!0)};this.opt_in=function(){h("cly_ignore",!1);this.ignore_visitor=
!1;ta();!this.ignore_visitor&&!ma&&B()};this.report_feedback=function(a){i("report_feedback, Deprecated function call! Use 'recordRatingWidgetWithID' in place of this call. Call will be redirected now!");this.recordRatingWidgetWithID(a)};this.recordRatingWidgetWithID=function(a){if(this.check_consent("star-rating"))if(a.widget_id)if(a.rating){var b={key:"[CLY]_star_rating",count:1,segmentation:{}};b.segmentation=T(a,"widget_id contactMe platform app_version rating email comment".split(" "));b.segmentation.app_version||
(b.segmentation.app_version=this.metrics._app_version||this.app_version);i("Reporting Rating Widget: ",b);this.add_cly_event(b)}else i("Rating Widget must contain rating property");else i("Rating Widget must contain widget_id property")};this.show_feedback_popup=function(a){i("show_feedback_popup, Deprecated function call! Use 'presentRatingWidgetWithID' in place of this call. Call will be redirected now!");this.presentRatingWidgetWithID(a)};this.presentRatingWidgetWithID=function(a){this.check_consent("star-rating")&&
(D?i("Cannot show ratingWidget popup in offline mode"):P(this.url+"/o/feedback/widget",{widget_id:a},function(a,b,c){a&&i("Error occurred",a);try{var e=JSON.parse(c);A(e,!1)}catch(g){i("JSON parse failed: "+g)}}))};this.initialize_feedback_popups=function(a){i("initialize_feedback_popups, Deprecated function call! Use 'initializeRatingWidgets' in place of this call. Call will be redirected now!");this.initializeRatingWidgets(a)};this.initializeRatingWidgets=function(a){if(this.check_consent("star-rating")){a||
(a=h("cly_fb_widgets"));for(var b=document.getElementsByClassName("countly-feedback-sticker");0<b.length;)b[0].remove();P(this.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(a)},function(a,b,c){if(a)i("Errors occurred:",a);else try{for(var f=JSON.parse(c),a=0;a<f.length;a++)if("true"===f[a].is_active&&f[a].target_devices[ra.device])if("string"===typeof f[a].hide_sticker&&(f[a].hide_sticker="true"===f[a].hide_sticker?!0:!1),"all"===f[a].target_page&&!f[a].hide_sticker)A(f[a],!0);
else for(var e=f[a].target_pages,b=0;b<e.length;b++){var d=e[b].substr(0,e[b].length-1)===window.location.pathname.substr(0,e[b].length-1),h=e[b]===window.location.pathname;(e[b].includes("*")&&d||h)&&!f[a].hide_sticker&&A(f[a],!0)}}catch(k){i("JSON parse error: "+k)}})}};this.enable_feedback=function(a){i("enable_feedback, Deprecated function call! Use 'enableRatingWidgets' in place of this call. Call will be redirected now!");this.enableRatingWidgets(a)};this.enableRatingWidgets=function(a){this.check_consent("star-rating")&&
(D?i("Cannot enable rating widgets in offline mode"):(h("cly_fb_widgets",a.popups||a.widgets),ka(this.url+"/star-rating/stylesheets/countly-feedback-web.css"),a=a.popups||a.widgets,0<a.length?(document.body.insertAdjacentHTML("beforeend",'<div id="cfbg"></div>'),this.initializeRatingWidgets(a)):i("You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback")))};this.get_available_feedback_widgets=function(a){this.check_consent("feedback")?
D?i("Cannot enable feedback in offline mode."):P(this.url+"/o/sdk",{method:"feedback",device_id:this.device_id,app_key:this.app_key},function(b,c,e){if(b)i("Error occurred while fetching feedbacks",b),a&&a(null,b);else try{var d=JSON.parse(e).result||[];a&&a(d,null)}catch(g){i("Error while processing feedbacks",g),a&&a(null,g)}}):a&&a(null,Error("Consent for feedback not provided."))};this.present_feedback_widget=function(a,b,c){function e(a){document.getElementById("countly-surveys-wrapper-"+a._id).style.display=
"block";document.getElementById("csbg").style.display="block"}if(this.check_consent("feedback"))if(!a||"object"!==typeof a||Array.isArray(a))i("Please provide at least one feedback widget object.");else try{var d=this.url;if("nps"===a.type)d+="/feedback/nps";else if("survey"===a.type)d+="/feedback/survey";else{i("Feedback widget only accepts nps and survey types.");return}var g=window.origin||window.location.origin,d=d+("?widget_id="+a._id),d=d+("&app_key="+this.app_key),d=d+("&device_id="+this.device_id),
d=d+("&sdk_name="+Ba),d=d+("&platform="+this.platform),d=d+("&app_version="+this.app_version),d=d+("&sdk_version="+la),d=d+("&origin="+g),d=d+"&widget_v=web",h=document.createElement("iframe");h.name="countly-surveys-iframe";h.id="countly-surveys-iframe";h.src=d;var k=!1;h.onload=function(){k&&(document.getElementById("countly-surveys-wrapper-"+a._id).style.display="none",document.getElementById("csbg").style.display="none");k=!0};ka(this.url+"/surveys/stylesheets/countly-surveys.css");for(var r=
document.getElementById("csbg");r;)r.remove(),r=document.getElementById("csbg");for(var n=document.getElementsByClassName("countly-surveys-wrapper"),d=0;d<n.length;d++)n[d].remove();n=document.createElement("div");n.className="countly-surveys-wrapper";n.id="countly-surveys-wrapper-"+a._id;"survey"===a.type&&(n.className=n.className+" "+a.appearance.position);var q=document.body,d=!1;b&&(document.getElementById(b)?(q=document.getElementById(b),d=!0):i("Provided id not found."));d||c&&(document.getElementsByClassName(c)[0]?
q=document.getElementsByClassName(c)[0]:i("Provided class not found."));q.insertAdjacentHTML("beforeend",'<div id="csbg"></div>');q.appendChild(n);n.appendChild(h);m(window,"message",function(b){var c={};try{c=JSON.parse(b.data)}catch(f){i("Error while parsing message body "+f)}b.origin===g&&c.close&&(document.getElementById("countly-surveys-wrapper-"+a._id).style.display="none",document.getElementById("csbg").style.display="none")});if("survey"===a.type){var p=!1;switch(a.showPolicy){case "afterPageLoad":"complete"===
document.readyState?p||(p=!0,e(a)):m(document,"readystatechange",function(b){"complete"===b.target.readyState&&!p&&(p=!0,e(a))});break;case "afterConstantDelay":setTimeout(function(){p||(p=!0,e(a))},1E4);break;case "onAbandon":"complete"===document.readyState?m(document,"mouseleave",function(){p||(p=!0,e(a))}):m(document,"readystatechange",function(b){"complete"===b.target.readyState&&m(document,"mouseleave",function(){p||(p=!0,e(a))})});break;case "onScrollHalfwayDown":m(window,"scroll",function(){if(!p){var b=
Math.max(window.scrollY,document.body.scrollTop,document.documentElement.scrollTop),c=X();b>=c/2&&(p=!0,e(a))}});break;default:p||(p=!0,e(a))}}else"nps"===a.type&&(document.getElementById("countly-surveys-wrapper-"+a._id).style.display="block",document.getElementById("csbg").style.display="block")}catch(s){i("Somethings went wrong while presenting the feedback",s)}};this.recordError=function(a,b,e){if(this.check_consent("crashes")&&a){var e=e||Ha,d="";"object"===typeof a?"undefined"!==typeof a.stack?
d=a.stack:("undefined"!==typeof a.name&&(d+=a.name+":"),"undefined"!==typeof a.message&&(d+=a.message+"\n"),"undefined"!==typeof a.fileName&&(d+="in "+a.fileName+"\n"),"undefined"!==typeof a.lineNumber&&(d+="on "+a.lineNumber),"undefined"!==typeof a.columnNumber&&(d+=":"+a.columnNumber)):d=a+"";e=u(e,c.maxKeyLength,c.maxValueSize,c.maxSegmentationValues,"record_error",c.debug);if(d.length>c.maxStackTraceLineLength*c.maxStackTraceLinesPerThread){i("Error stack is too long will be truncated");d=d.split("\n");
d.length>c.maxStackTraceLinesPerThread&&(d=d.splice(0,c.maxStackTraceLinesPerThread));for(var a=0,h=d.length;a<h;a++)d[a].length>c.maxStackTraceLineLength&&(d[a]=d[a].substring(0,c.maxStackTraceLineLength));d=d.join("\n")}b=b?!0:!1;a=ba();d={_resolution:a._resolution,_error:d,_app_version:a._app_version,_run:n()-Ra,_not_os_specific:!0,_javascript:!0};if(a=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery)d._bat=Math.floor(100*a.level);"undefined"!==typeof navigator.onLine&&
(d._online=navigator.onLine?!0:!1);d._background=document.hasFocus()?!1:!0;0<Q.length&&(d._logs=Q.join("\n"));Q=[];d._nonfatal=b;d._view=this.getViewName();"undefined"!==typeof e&&(d._custom=e);try{var g=document.createElement("canvas").getContext("experimental-webgl");d._opengl=g.getParameter(g.VERSION)}catch(k){}p({crash:JSON.stringify(d)})}};this.onStorageChange=function(a,b){switch(a){case "cly_queue":s=c.deserialize(b||"[]");break;case "cly_event":t=c.deserialize(b||"[]");break;case "cly_remote_configs":w=
c.deserialize(b||"{}");break;case "cly_ignore":c.ignore_visitor=c.deserialize(b);break;case "cly_id":c.device_id=c.deserialize(b)}};this._internals={store:h,getDocWidth:ja,getDocHeight:X,getViewportHeight:wa,get_page_coord:ia,get_event_target:da,add_event:m,getProperties:T,truncateObject:u,truncateSingleValue:k,stripTrailingSlash:ha,prepareParams:va,sendXmlHttpRequest:P,getMsTimestamp:fa,getTimestamp:n,log:i,getMetrics:ba,generateUUID:ua,isUUID:function(){return/[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-4[0-9a-fA-F]{3}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}/.test(c.device_id)},
getId:M,heartBeat:B,toRequestQueue:p,reportViewDuration:L,loadJS:ya,loadCSS:ka,getLastView:function(){return N},setToken:Ga,getToken:function(){var a=h("cly_token");h("cly_token",null);return a},showLoader:za,hideLoader:Aa,add_cly_events:r,detect_device:ra,getRequestQueue:function(){return s},getEventQueue:function(){return t},clearQueue:function(){s=[];h("cly_queue",[]);t=[];h("cly_event",[])}};this.initialize()};e.init=function(b){var b=b||{},d=b.app_key||e.app_key;if(!e.i||!e.i[d]){b=new e.CountlyClass(b);
if(!e.i){e.i={};for(var k in b)e[k]=b[k]}e.i[d]=b}return e.i[d]};var A=0,m=function(b,e,d){"undefined"!==typeof b.addEventListener?b.addEventListener(e,d,!1):b.attachEvent("on"+e,d)},da=function(b){return b?"undefined"!==typeof b.target?b.target:b.srcElement:window.event.srcElement},ra,K=navigator.userAgent.toLowerCase(),L=function(b){b&&(K=(b+"").toLowerCase());return/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(K)?"tablet":
/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/.test(K)?"phone":"desktop"};ra={device:L(),detect:L,isMobile:"desktop"!==L()?!0:!1,userAgent:K};window.addEventListener("storage",function(b){var d=(b.key+"").split("/"),k=d.pop(),d=d.pop();if(e.i&&e.i[d])e.i[d].onStorageChange(k,b.newValue)});e.serialize=function(b){"object"===typeof b&&(b=JSON.stringify(b));return b};e.deserialize=function(b){try{b=
JSON.parse(b)}catch(d){}return b};e.getViewName=function(){return window.location.pathname};e.getViewUrl=function(){return window.location.pathname};return e}});
